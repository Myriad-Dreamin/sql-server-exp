## 数据库实验第三次实验

Myriad Dreamin 2017211279 2017211301

## 实验目的

- 通过实验了解通用数据库应用编程接口ODBC的基本原理和实现机制，熟悉主要的ODBC接口的语法和使用方法；
- 利用C语言(或其它支持ODBC接口的高级程序设计语言)编程实现简单的数据库应用程序，掌握基于ODBC的数据库访问的基本原理和方法。

## 实验平台及环境

- 系统: Ubuntu18.04 LTS
- 环境: Docker 18.09.7
- 数据库版本: Microsoft SQL Server 2017

## 实验内容

+ 本实验内容主要是如何通过数据库接口访问（包括增、删、改）数据库中的数据；
+ 要求能够通过编写程序或者使用SQL Server工具访问到数据，该实验的重点在于ODBC数据源配置和工具使用。

+ 在Windows控制面板中通过管理工具下的ODBC数据源工具在客户端新建连接到SQL Server服务器的ODBC数据源，测试通过后保存，注意名字应与应用程序中引用的数据源一致。

+ 编译程序并调试通过。

实验过程要求：

+ 以SQL语言相关内容为基础，课后查阅、自学ODBC接口有关内容，包括ODBC的体系结构、工作原理、数据访问过程、主要API接口的语法和使用方法等。
+ 以实验二建立的数据库为基础，编写 C语言(或其它支持ODBC接口的高级程序设计语言) 数据库应用程序，按照如下步骤访问数据库：
    + ODBC初始化，为ODBC分配环境句柄；
    + 建立应用程序与ODBC数据源的连接；
    + 实现数据库应用程序对数据库中表的数据查询、修改、删除、插入等操作。
    + 结束数据库应用程序。

由于不是程序设计练习，因此针对一张表进行操作，即可完成基本要求。

若程序结构和功能完整，界面友好，可适当增加分数。

实验相关语句要求：

+ 所编写的数据库访问应用程序应使用到以下主要的ODBC API函数：
    + SQLALLocEnv：初始化ODBC环境，返回环境句柄；
    + SQLALLocConnect：为连接句柄分配内存并返回连接句柄；

    + SQLConnect：连接一个SQL数据资源；

    + SQLDriverConnect：连接一个SQL数据资源，允许驱动器向用户询问信息；
    + SQLALLocStmt：为语句句柄分配内存, 并返回语句句柄；
    + SQLExecDirect：把SQL语句送到数据库服务器，请求执行由SQL语句定义的数据库访问；

    + SQLFetchAdvances：将游标移动到查询结果集的下一行(或第一行)；

    + SQLGetData：按照游标指向的位置，从查询结果集的特定的一列取回数据；

    + SQLFreeStmt：释放与语句句柄相关的资源；
    + SQLDisconnect：切断连接；
    + SQLFreeConnect：释放与连接句柄相关的资源；

    + SQLFreeEnv：释放与环境句柄相关的资源。

## 实验步骤

本程序在windows和linux上均可运行，但在windows上需要解决一定兼容性问题，比如链接`odbccp32.lib`。

打开运行如下：

![1](./img/1.png)

由于记住了密码。按下登出键，如下：

![2](./img/2.png)

可以在设置中配置DSN和密码保存路径，注意把路径设为`400`（如果在windows下，则禁用权限继承并只允许自己访问）

![3](./img/3.png)



![4](./img/4.png)


![5](./img/5.png)
